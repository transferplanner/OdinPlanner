<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Dashboard - Final Success</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
<link id="themeLink" rel="stylesheet" href="">
<script src="trial.js"></script>
<script>
        // 1. trial.jsì—ì„œ ì €ì¥ëœ 'ìƒ‰ìƒ'ì„ ê°€ì ¸ì˜¤ê³ 
        const theme = getSavedTheme()|| "pink";
        // 2. ì´ í˜ì´ì§€ì˜ 'ì—­í• (check)'ì„ ì¡°í•©í•´ì„œ ê²½ë¡œ ì™„ì„±!
        const themePath = `${theme}/index.css`; 
        document.getElementById("themeLink").href = themePath;
    </script>

  <link rel="manifest" href="manifest.JSON">
</head>


<body>
  <div class="header-banner"></div>
  <div class="container">
    <section class="title-section">
     <img src="Odin_logo.png" style="height: 90px !important; width: auto; object-fit: contain; flex-shrink: 0;" alt="Odin Planner Logo">
      <h1 style="margin:0; font-size:24px;">transfer-planner</h1>
    </section>

    <div class="main-layout">
      <div class="left-col">
        <div class="block pink-block" style="margin-bottom:20px; min-height: 200px;">
          <div class="calendar-header">
            <span onclick="moveMonth(-1)" style="cursor:pointer; margin-right:10px;">â—€</span>
            <span id="monthYear"></span>
            <span onclick="moveMonth(1)" style="cursor:pointer; margin-left:10px;">â–¶</span>
          </div>
  
        <div id="calendarDays" class="calendar-grid"></div>
      </div>
        <div class="block">
          <div class="timer-header">
            <h3 style="margin:0; font-size:15px;">â±ï¸ íƒ€ì´ë¨¸</h3>
            <div class="mode-settings">
              <button class="mode-btn" onclick="setTimer(25, 5)">25/5</button>
              <button class="mode-btn" onclick="setTimer(45, 15)">45/15</button>
             </div>
          </div>

  <div class="time-display" id="display">00:00:00</div>

  <div class="timer-btns">
    <button onclick="startTimer()">Start</button>
    <button onclick="pauseTimer()" style="background:#eee; color:#666; margin-left:5px;">Pause</button>
    <button onclick="resetTimer()" style="background:#fff0f3; color:var(--main-pink); margin-left:5px;">Reset</button>
  </div>
</div>


        <div class="theme-selector">
  <button class="theme-dot pink" data-theme="pink"></button>
  <button class="theme-dot purple" data-theme="purple"></button>
  <button class="theme-dot blue" data-theme="blue" ></button>
  <button class="theme-dot green" data-theme="green"></button>
</div>
      </div>

      <div class="mid-col" style="display:flex; flex-direction:column; gap:20px;">
        <div class="block pink-block">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <h3 style="margin:0; font-size:15px;">ğŸ† ì„±ì·¨ DB</h3>
            <a href="achievement.html" class="move-btn">ì´ë™ â”</a>
          </div>
          <div style="background:white; flex:1; border-radius:12px; padding:15px; display:flex; flex-direction:column; justify-content:center; gap:12px; border:1px solid #f0f0f0;">
            <div style="text-align:center;">
              <div style="font-size:11px; color:#888;">ì˜¤ëŠ˜ì˜ ìˆœê³µ ì‹œê°„</div>
              <div id="achieve-time" style="font-size:24px; font-weight:bold; color:var(--main-pink);">00:00:00</div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-size:10px; margin-bottom:5px;">
                <span>ëª©í‘œ ë‹¬ì„±ë¥ </span><span id="achieve-percent" style="font-weight:bold;">0%</span>
              </div>
              <div style="background:#eee; height:10px; border-radius:5px; overflow:hidden;">
                <div id="achieve-bar" style="width:0%; background:var(--main-pink); height:100%; transition:0.5s;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="db-card locked">
        <div class="block pink-block">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <div style="display:flex; align-items:center; gap:8px;">
              <h3 style="margin:0; font-size:15px;">ğŸ¯ ëª©í‘œ DB</h3>
              <button id="majorToggle" onclick="toggleMajor()"
                style="font-size:10px; padding:2px 8px; border-radius:10px; border:1px solid var(--main-pink); background:white; color:var(--main-pink); cursor:pointer; font-weight:900;">
                ìˆ˜í•™
              </button>
            </div>
            <a href="goal.html" class="move-btn">ì´ë™ â”</a>
          </div>
          

          <div style="background:white; flex:1; border-radius:12px; padding:12px; display:flex; flex-direction:column; justify-content:center; border:1px solid #f0f0f0;">
            <div style="text-align:center; margin-bottom:8px;">
              <div style="font-size:10px; color:#888; margin-bottom:4px;">í˜„ì¬ ê°€ì¥ ìœ ë¦¬í•œ ëŒ€í•™êµ</div>
              <div style="font-size:20px; font-weight:800; color:#1f2a44;"><span id="mainBestSchoolName"></span></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
              <div style="background:var(--point-pink); padding:8px; border-radius:8px; text-align:center;">
                <div style="font-size:9px; color:#888;">ê¸°ì¶œ í‰ê· </div>
                <div id="mainSchoolAvg" style="font-size: 16px; font-weight: bold;">-</div>
                <div id="mainAvgDiff" style="font-size:9px; color:var(--main-pink); font-weight:bold;">-</div>
              </div>
              <div style="background:var(--point-pink); padding:8px; border-radius:8px; text-align:center;">
                <div style="font-size:9px; color:#888;">í‘œì¤€í¸ì°¨</div>
                <div id="mainSchoolStd" style="font-size:16px; font-weight:bold;">-</div>
                <div style="font-size:9px; color:#666;">ë³€ë™í­ ì¼ì •</div>
              </div>
            </div>
            <p style="margin:8px 0 0; font-size:9px; color:#999; text-align:center;">â€» ìµœê·¼ 3ê°œë…„ ê¸°ì¶œ ë°ì´í„° ê¸°ë°˜ ì¶”ì •</p>
          </div>
        </div>
      </div>
      </div>

      <div class="right-col">
        <div class="block" style="height: 100%;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="color:var(--main-pink); margin:0; font-size:15px;">ğŸ•’ Tracker</h3>
          </div>
          <div style="display: flex; gap: 4px; align-items: center; justify-content: space-between; margin-bottom: 5px;">
            <select id="s-hour"></select>
            <select id="s-min">
              <option value="0">00</option><option value="10">10</option>
              <option value="20">20</option><option value="30">30</option>
              <option value="40">40</option><option value="50">50</option>
            </select>
            <span style="font-size:10px;">~</span>
            <select id="e-hour"></select>
            <select id="e-min">
              <option value="0">00</option><option value="10">10</option>
              <option value="20">20</option><option value="30">30</option>
              <option value="40">40</option><option value="50">50</option>
            </select>
          </div>
          <input type="text" id="t-sub" placeholder="ê³¼ëª© ì…ë ¥" style="width:100%; margin-bottom:5px;">
          <button onclick="addTimeBlock()" style="width:100%; background:var(--main-pink); color:white; border:none; padding:7px; border-radius:4px; font-weight:bold; cursor:pointer; font-size:12px;">ê¸°ë¡ ì¶”ê°€</button>
          <div style="flex:1; overflow-y:auto; border-top:1px solid #eee; margin-top:10px;">
            <table class="tracker-table">
              <thead><tr><th>H</th><th>00</th><th>10</th><th>20</th><th>30</th><th>40</th><th>50</th></tr></thead>
              <tbody id="tracker-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-layout">
      <div class ="db-card locked">
      <div class="block pink-block">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <h3 style="margin:0; font-size:15px;">ğŸ“ ì²´í¬ DB</h3>
            <button id="checkSubject" onclick="toggleMajor()" style="font-size:11px; padding:3px 10px; border-radius:10px; border:1px solid var(--main-pink); background:white; color:var(--main-pink); cursor:pointer; font-weight:900;">ìˆ˜í•™</button>
          </div>
          <a href="check.html" class="move-btn">ì´ë™ â”</a>
        </div>
        

        <div style="display:flex; gap:10px; flex:1;">
          <div style="flex:1; background:white; padding:15px; border-radius:12px; display:flex; flex-direction:column; align-items:center; gap:8px; border:1px solid #f0f0f0;">
            <div style="font-size:10px; color:#888;">ğŸ” ìì£¼ ì‹¤ìˆ˜í•˜ëŠ” ìœ í˜•</div>
            <div id="main-top-error" style="font-weight:bold; color:var(--main-pink); font-size:13px;">ê¸°ë¡ ì—†ìŒ</div>
            <div style="width:65px; height:65px;"><canvas id="main-error-chart"></canvas></div>
          </div>
          <div style="flex:1; background:white; padding:15px; border-radius:12px; display:flex; flex-direction:column; align-items:center; gap:8px; border:1px solid #f0f0f0;">
            <div style="font-size:10px; color:#888;">âš ï¸ ì§‘ì¤‘ í•„ìš” íŒŒíŠ¸</div>
            <div id="main-top-part" style="font-weight:bold; color:var(--main-pink); font-size:13px;">ê¸°ë¡ ì—†ìŒ</div>
            <div style="width:65px; height:65px;"><canvas id="main-part-chart"></canvas></div>
          </div>
        </div>
      </div>
      </div>

      <div class = "db-card locked">
      <div class="block pink-block">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <h3 style="margin:0; font-size:15px;">ğŸ“Š ì‹œí—˜ DB </h3>
            <button id="examSubject" onclick="toggleMajor()" style="font-size:11px; padding:3px 10px; border-radius:10px; border:1px solid var(--main-pink); background:white; color:var(--main-pink); cursor:pointer; font-weight:900;">ìˆ˜í•™</button>
          </div>
          <a href="exam.html" class="move-btn">ì´ë™ â”</a>
        </div>
        <div style="display:flex; flex-direction:column; gap:12px; flex:1;">
          <div style="background:white; padding:12px; border-radius:10px; border:1px solid #f0f0f0;">
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:8px;">
              <span style="font-weight:bold;">ğŸ“” ëª¨ì˜ê³ ì‚¬</span>
              <span id="main-mock-score-info" style="font-size:10px; color:#666;">ì—°ê²° ì¤‘...</span>
            </div>
            <div style="background:#eee; height:8px; border-radius:4px; overflow:hidden;">
              <div id="main-mock-bar" style="width:0%; background:var(--main-pink); height:100%; transition: 0.5s;"></div>
            </div>
          </div>
          <div style="background:white; padding:12px; border-radius:10px; border:1px solid #f0f0f0;">
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:8px;">
              <span style="font-weight:bold;">ğŸ“Š ê¸°ì¶œ í‰ê· </span>
              <span id="main-past-score-info" style="font-size:10px; color:#666;">ì—°ê²° ì¤‘...</span>
            </div>
            <div style="background:#eee; height:8px; border-radius:4px; overflow:hidden;">
              <div id="main-past-bar" style="width:0%; background:var(--main-pink); height:100%; transition: 0.5s;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <script src = "goal.html"></script>
  <script>
    // ğŸŒ¸ ê¸°ë³¸ ê³¼ëª©
    let currentMajor = "ìˆ˜í•™";

    function toggleMajor() {
      currentMajor = (currentMajor === "ìˆ˜í•™") ? "ì˜ì–´" : "ìˆ˜í•™";

      const majorBtn = document.getElementById('majorToggle');
      const checkBtn = document.getElementById('checkSubject');
      const examBtn  = document.getElementById('examSubject');

      if(majorBtn) majorBtn.innerText = currentMajor;
      if(checkBtn) checkBtn.innerText = currentMajor;
      if(examBtn)  examBtn.innerText  = currentMajor;

      syncCheckData();
      syncMainExamData();   // âœ… ì—¬ê¸° ê·¸ëŒ€ë¡œ
      renderMainBest();
    }

    /* íƒ€ì´ë¨¸ */
    /* ğŸ§± ì‚¬ì¥ë‹˜ì„ ìœ„í•œ ì™„ì „íŒ ì½”ë“œ: ëª¨ë°”ì¼ì—ì„œë„ ì°°ë–¡ê°™ì´ ë¶™ìŠµë‹ˆë‹¤! */

/* ğŸ§± ëª¨ë°”ì¼ í„°ì¹˜ ì§€ì—° ì—†ì´ ë°”ë¡œ ë°˜ì‘í•˜ëŠ” ì™„ì „íŒ */

/* ğŸ§± ì‚¬ì¥ë‹˜, ì´ê±´ ë¬´ì¡°ê±´ ë– ì•¼ í•©ë‹ˆë‹¤. ëª¨ë“  ë°©í•´ ìš”ì†Œë¥¼ ì œê±°í–ˆì–´ìš”. */

// ===========================
// âœ… Timer (Mobile-safe) Full
// - prompt() ì œê±°: WebViewì—ì„œ ì…ë ¥ ì”¹í˜ ë°©ì§€
// - ë””ìì¸(HTML/CSS) ì†ëŒ€ì§€ ì•ŠìŒ: JSë¡œ ì˜¤ë²„ë ˆì´ë§Œ ì ê¹ ìƒì„±
// ===========================

let timerInterval = null;
let totalSeconds = 0;
let nextBreakSeconds = 0;

const $display = document.getElementById("display");

// 1) í‘œì‹œ ì˜ì—­ í´ë¦­í•˜ë©´ ì‹œê°„ ì„¤ì • UI(ì˜¤ë²„ë ˆì´) ì—´ê¸°
if ($display) {
  $display.style.cursor = "pointer";
  $display.addEventListener("click", () => openTimerSetOverlay());
}

// 2) íƒ€ì´ë¨¸ ì‹œì‘/ì¼ì‹œì •ì§€/ë¦¬ì…‹ (ê¸°ì¡´ ë²„íŠ¼ì—ì„œ ê·¸ëŒ€ë¡œ í˜¸ì¶œ ê°€ëŠ¥)
function startTimer() {
  // 0ì´ˆë©´ ë‹¹ì—°íˆ ì•ˆ ì›€ì§ì´ë‹ˆê¹Œ: ì•ˆë‚´ë¥¼ ëª…í™•íˆ
  if (totalSeconds <= 0) {
    alert("ë¨¼ì € ì‹œê°„ì„ ì„¤ì •í•´ì¤˜! (ì‹œê°„ í‘œì‹œë¥¼ ëˆŒëŸ¬ì„œ ì„¤ì • ê°€ëŠ¥)");
    return;
  }
  if (timerInterval) return;

  timerInterval = setInterval(() => {
    totalSeconds--;
    if (totalSeconds <= 0) {
      totalSeconds = 0;
      updateTimerDisplay();
      pauseTimer();
     
     if (nextBreakSeconds > 0) {
        alert("ğŸŒ¸ ì§‘ì¤‘ ë! ì´ì œ íœ´ì‹ ì‹œê°„ ì‹œì‘ì´ì•¼! ğŸŒ¸");
        totalSeconds = nextBreakSeconds;
        nextBreakSeconds = 0; // íœ´ì‹ ëª¨ë“œ í•´ì œ (ì¼íšŒìš© ì˜ˆì•½ê¶Œ ì‚¬ìš©)
        updateTimerDisplay();
    } else {
        alert("ğŸŒ¸ ê³ ìƒí–ˆì–´! íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ğŸŒ¸");
    }
      return;
    }
    updateTimerDisplay();
  }, 1000);

  updateTimerDisplay();
}

function pauseTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function resetTimer() {
  pauseTimer();
  totalSeconds = 0;
  updateTimerDisplay();
}

function updateTimerDisplay() {
  if (!$display) return;

  if (!Number.isFinite(totalSeconds) || totalSeconds < 0) totalSeconds = 0;

  const h = Math.floor(totalSeconds / 3600);
  const m = Math.floor((totalSeconds % 3600) / 60);
  const s = totalSeconds % 60;

  $display.innerText =
    `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
}

// 3) ëª¨ë°”ì¼ì—ì„œë„ 100% ë™ì‘í•˜ëŠ” "ì‹œê°„ ì„¤ì • ì˜¤ë²„ë ˆì´"
function openTimerSetOverlay() {
  // ì´ë¯¸ ë–  ìˆìœ¼ë©´ ì¤‘ë³µ ìƒì„± ë°©ì§€
  if (document.getElementById("timerSetOverlay")) return;

  // í˜„ì¬ í‘œì‹œê°’ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
  const cur = secondsToHMS(totalSeconds);
  const defaultH = cur.h;
  const defaultM = cur.m;
  const defaultS = cur.s;

  // ì˜¤ë²„ë ˆì´(ë°˜íˆ¬ëª… ë°°ê²½)
  const overlay = document.createElement("div");
  overlay.id = "timerSetOverlay";
  overlay.style.position = "fixed";
  overlay.style.left = "0";
  overlay.style.top = "0";
  overlay.style.width = "100%";
  overlay.style.height = "100%";
  overlay.style.background = "rgba(0,0,0,0.45)";
  overlay.style.display = "flex";
  overlay.style.alignItems = "center";
  overlay.style.justifyContent = "center";
  overlay.style.zIndex = "999999";

  // ì¹´ë“œ ë°•ìŠ¤
  const box = document.createElement("div");
  box.style.width = "min(92vw, 360px)";
  box.style.background = "#fff";
  box.style.borderRadius = "16px";
  box.style.padding = "16px";
  box.style.boxShadow = "0 10px 30px rgba(0,0,0,0.2)";
  box.style.fontFamily = "inherit";

  // ì œëª©
  const title = document.createElement("div");
  title.innerText = "ì§‘ì¤‘ ì‹œê°„ ì„¤ì •";
  title.style.fontSize = "16px";
  title.style.fontWeight = "800";
  title.style.marginBottom = "10px";

  // ì„¤ëª…
  const desc = document.createElement("div");
  desc.innerText = "ì‹œ/ë¶„/ì´ˆë¥¼ ì…ë ¥í•´ì¤˜ (ì˜ˆ: 00:50:00)";
  desc.style.fontSize = "13px";
  desc.style.opacity = "0.75";
  desc.style.marginBottom = "12px";

  // ì…ë ¥ ì¤„
  const row = document.createElement("div");
  row.style.display = "flex";
  row.style.gap = "8px";
  row.style.alignItems = "center";
  row.style.marginBottom = "12px";

  const hInput = makeNumberInput("ì‹œ", defaultH, 0, 23);
  const mInput = makeNumberInput("ë¶„", defaultM, 0, 59);
  const sInput = makeNumberInput("ì´ˆ", defaultS, 0, 59);

  row.appendChild(hInput.wrap);
  row.appendChild(mInput.wrap);
  row.appendChild(sInput.wrap);

  // ë²„íŠ¼ ì¤„
  const btnRow = document.createElement("div");
  btnRow.style.display = "flex";
  btnRow.style.gap = "8px";
  btnRow.style.justifyContent = "flex-end";

  const cancelBtn = document.createElement("button");
  cancelBtn.type = "button";
  cancelBtn.innerText = "ì·¨ì†Œ";
  cancelBtn.style.padding = "10px 12px";
  cancelBtn.style.borderRadius = "12px";
  cancelBtn.style.border = "1px solid rgba(0,0,0,0.15)";
  cancelBtn.style.background = "#fff";
  cancelBtn.style.fontWeight = "700";
  cancelBtn.addEventListener("click", () => overlay.remove());

  const okBtn = document.createElement("button");
  okBtn.type = "button";
  okBtn.innerText = "ì„¤ì •";
  okBtn.style.padding = "10px 12px";
  okBtn.style.borderRadius = "12px";
  okBtn.style.border = "none";
  okBtn.style.background = "#111";
  okBtn.style.color = "#fff";
  okBtn.style.fontWeight = "800";

  okBtn.addEventListener("click", () => {
    const hh = clampInt(hInput.input.value, 0, 23);
    const mm = clampInt(mInput.input.value, 0, 59);
    const ss = clampInt(sInput.input.value, 0, 59);

    const next = (hh * 3600) + (mm * 60) + ss;

    // 0ì´ˆ ì…ë ¥í•˜ë©´ ê·¸ëƒ¥ 0ìœ¼ë¡œ ë‘ë˜, UXìƒ ì•ˆë‚´
    totalSeconds = Number.isFinite(next) ? next : 0;
    updateTimerDisplay();

    // ì‹¤í–‰ ì¤‘ì´ë©´(ì¹´ìš´íŠ¸ì¤‘) ì‹œê°„ ë°”ê¿¨ì„ ë•Œ ì¦‰ì‹œ ë°˜ì˜ë˜ê²Œ ìœ ì§€
    // (ì›í•˜ë©´ pauseTimer()ë¥¼ ë„£ì–´ì„œ ë°”ê¿€ ë•Œ ë©ˆì¶”ê²Œ í•  ìˆ˜ë„ ìˆìŒ)

    overlay.remove();
  });

  btnRow.appendChild(cancelBtn);
  btnRow.appendChild(okBtn);

  // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) overlay.remove();
  });

  // ì¡°ë¦½
  box.appendChild(title);
  box.appendChild(desc);
  box.appendChild(row);
  box.appendChild(btnRow);
  overlay.appendChild(box);
  document.body.appendChild(overlay);

  // í¬ì»¤ìŠ¤
  mInput.input.focus();
}

// ìœ í‹¸: ì…ë ¥ ë°•ìŠ¤ ë§Œë“¤ê¸°
function makeNumberInput(label, value, min, max) {
  const wrap = document.createElement("div");
  wrap.style.flex = "1";
  wrap.style.display = "flex";
  wrap.style.flexDirection = "column";
  wrap.style.gap = "6px";

  const lab = document.createElement("div");
  lab.innerText = label;
  lab.style.fontSize = "12px";
  lab.style.fontWeight = "800";
  lab.style.opacity = "0.75";

  const input = document.createElement("input");
  input.type = "number";
  input.inputMode = "numeric";
  input.min = String(min);
  input.max = String(max);
  input.value = String(value ?? 0);
  input.style.padding = "10px 12px";
  input.style.borderRadius = "12px";
  input.style.border = "1px solid rgba(0,0,0,0.15)";
  input.style.fontSize = "14px";
  input.style.fontWeight = "800";
  input.style.outline = "none";

  // ì…ë ¥ ì œí•œ(ì´ìƒí•œ ê°’ ë°©ì§€)
  input.addEventListener("input", () => {
    const v = clampInt(input.value, min, max);
    input.value = String(v);
  });

  wrap.appendChild(lab);
  wrap.appendChild(input);

  return { wrap, input };
}

function clampInt(v, min, max) {
  const n = Number(String(v).replace(/[^\d]/g, ""));
  if (!Number.isFinite(n)) return min;
  return Math.min(max, Math.max(min, Math.floor(n)));
}

function secondsToHMS(sec) {
  const s = Math.max(0, Number(sec) || 0);
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const r = s % 60;
  return { h, m, s: r };
}

// ìµœì´ˆ í‘œì‹œ ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
updateTimerDisplay();

// --- ê¸°ì¡´ ì½”ë“œë“¤ (openTimerSetOverlay ë“±)ì€ ê·¸ëŒ€ë¡œ ë‘ì„¸ìš” ---

function setTimer(focusMin, breakMin) {
  pauseTimer(); 
  
  // 1. ì§‘ì¤‘ ì‹œê°„ ì„¸íŒ…
  totalSeconds = focusMin * 60; 
  
  // 2. íœ´ì‹ ì‹œê°„ë„ ë¯¸ë¦¬ ê¸°ì–µí•´ë‘¬ìš” (5ë¶„ì´ë‚˜ 15ë¶„)
  nextBreakSeconds = breakMin * 60; 
  
  updateTimerDisplay();
}
// âœ… ë²„íŠ¼ í´ë¦­ ì‹œ ì‹œê°„ì„ ë°”ë¡œ ì„¸íŒ…í•´ì£¼ëŠ” í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
// ì„œì—°ì´ê°€ ì„¤ì •í•œ íœ´ì‹ ì‹œê°„ì„ ê¸°ì–µí•´ë‘˜ ìƒìì˜ˆìš”.

    /* íŠ¸ë˜ì»¤ */
    function initTrackerUI() {
      const sH = document.getElementById('s-hour'), eH = document.getElementById('e-hour');
      sH.innerHTML = eH.innerHTML = "";
      for (let i = 5; i <= 24; i++) {
        const hStr = String(i).padStart(2, '0');
        sH.innerHTML += `<option value="${i}">${hStr}ì‹œ</option>`;
        eH.innerHTML += `<option value="${i}">${hStr}ì‹œ</option>`;
      }
      sH.value = "9"; eH.value = "10";

      const body = document.getElementById('tracker-body');
      body.innerHTML = '';
      const savedData = JSON.parse(localStorage.getItem('tracker_data') || '{}');

      for(let h=5; h<=24; h++){
        const tr = document.createElement('tr');
        tr.innerHTML = `<th>${String(h).padStart(2, '0')}</th>`;
        for(let m=0; m<60; m+=10){
          const td = document.createElement('td');
          const id = `t-${String(h).padStart(2, '0')}-${m}`;
          td.id = id;
          if(savedData[id]) td.style.background = savedData[id];
          td.onclick = function(){
            this.style.background = this.style.background ? '' : 'var(--main-pink)';
            saveTracker();
          };
          tr.appendChild(td);
        }
        body.appendChild(tr);
      }
      saveTracker();
    }

    function addTimeBlock() {
      const sh = parseInt(document.getElementById('s-hour').value),
            eh = parseInt(document.getElementById('e-hour').value);
      const sm = parseInt(document.getElementById('s-min').value),
            em = parseInt(document.getElementById('e-min').value);
      const sub = document.getElementById('t-sub').value;
      if (!sub) { alert("ê³¼ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

      const color = sub.includes("ìˆ˜í•™") ? 'var(--color-math)' :
                    (sub.includes("ì˜ì–´") ? 'var(--color-eng)' : 'var(--color-etc)');

      for (let t = sh * 60 + sm; t < eh * 60 + em; t += 10) {
        const target = document.getElementById(`t-${String(Math.floor(t / 60)).padStart(2, '0')}-${t % 60}`);
        if (target) target.style.background = color;
      }
      saveTracker();
    }

    function saveTracker(){
      const data = {};
      let activeBlocks = 0;
      document.querySelectorAll('.tracker-table td').forEach(td => {
        if(td.style.background && td.style.background !== 'rgba(0, 0, 0, 0)') {
          data[td.id] = td.style.background;
          activeBlocks++;
        }
      });
      localStorage.setItem('tracker_data', JSON.stringify(data));

      const totalMinutes = activeBlocks * 10;
      const h = Math.floor(totalMinutes / 60), m = totalMinutes % 60;
      localStorage.setItem('today_study_time', `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:00`);
      syncAchievePreview();
    }

    /* ìº˜ë¦°ë” */
    /* ìº˜ë¦°ë” (ëª©í‘œ DB: gi_db_v2 ì—°ë™ ë²„ì „) */
// 1. í˜„ì¬ ë³´ê³  ìˆëŠ” ì—°ë„ì™€ ë‹¬ì„ ê¸°ì–µí•  ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ìš”.
// localStorageì—ì„œ SCHOOL_DB ë¶ˆëŸ¬ì˜¤ê¸°
const rawData = localStorage.getItem('SCHOOL_DB');
let SCHOOL_DB = {};

if (rawData) {
  try {
    SCHOOL_DB = JSON.parse(rawData);
  } catch (e) {
    console.error('DB íŒŒì‹± ì˜¤ë¥˜:', e);
  }
}

let viewYear = new Date().getFullYear();
let viewMonth = new Date().getMonth();

function buildCalendar() {
  document.getElementById('monthYear').innerText = `${viewYear}ë…„ ${viewMonth + 1}ì›”`;
  
  const grid = document.getElementById('calendarDays');
  grid.innerHTML = '';

  ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=> {
    const el=document.createElement('div');
    el.innerText=d; el.style.fontWeight='bold'; el.style.color='#aaa';
    grid.appendChild(el);
  });

  const firstDay = new Date(viewYear, viewMonth, 1).getDay();
  const lastDate = new Date(viewYear, viewMonth + 1, 0).getDate();
  
  for(let i=0; i<firstDay; i++) grid.appendChild(document.createElement('div'));

  // âœ… exam ë‚ ì§œì™€ í•™êµ ì´ë¦„ì„ í•¨ê»˜ ì €ì¥
  const examDateMap = {}; // { "2026-01-10": ["ì„œê°•ëŒ€", "ì—°ì„¸ëŒ€"], ... }
  
  for (let schoolName in SCHOOL_DB) {
    const school = SCHOOL_DB[schoolName];
    
    if (school.exam) {
      if (!examDateMap[school.exam]) {
        examDateMap[school.exam] = [];
      }
      examDateMap[school.exam].push(schoolName);
    }
    
    if (school.campuses) {
      for (let campusName in school.campuses) {
        if (school.campuses[campusName].exam) {
          const examDate = school.campuses[campusName].exam;
          if (!examDateMap[examDate]) {
            examDateMap[examDate] = [];
          }
          examDateMap[examDate].push(`${schoolName} (${campusName})`);
        }
      }
    }
  }
  
  console.log('ìˆ˜ì§‘ëœ ì‹œí—˜ ì •ë³´:', examDateMap);

  for(let i=1; i<=lastDate; i++){
    const d=document.createElement('div');
    d.style.position = 'relative';
    d.innerText=i;
    
    const realToday = new Date();
    if(i === realToday.getDate() && viewMonth === realToday.getMonth() && viewYear === realToday.getFullYear()) {
        d.className='today';
    }

    const dateStr = `${viewYear}-${String(viewMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
    
    // âœ… ì´ ë‚ ì§œì— ì‹œí—˜ì´ ìˆìœ¼ë©´
    if (examDateMap[dateStr]) {
  const dot = document.createElement('div');
  dot.className = 'exam-dot';
  
  // âœ… data ì†ì„±ì— í•™êµ ì´ë¦„ ì €ì¥
  const schools = examDateMap[dateStr].join(', ');
  dot.setAttribute('data-schools', `${schools} ì‹œí—˜`);
  
  d.appendChild(dot);
}
    grid.appendChild(d);
  }
}

// 4. [ìƒˆ ë²½ëŒ] ë‹¬ì„ ì´ë™ì‹œí‚¤ëŠ” í•¨ìˆ˜ì˜ˆìš”!
function moveMonth(delta) {
  viewMonth += delta;
  if (viewMonth < 0) { viewMonth = 11; viewYear--; }
  if (viewMonth > 11) { viewMonth = 0; viewYear++; }
  buildCalendar(); // ë°”ë€ ë‹¬ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°!
}



    function syncAchievePreview(){
      const time = localStorage.getItem('today_study_time') || "00:00:00";
      document.getElementById('achieve-time').innerText = time;
      document.getElementById('achieve-percent').innerText = savedProgress + "%";
      document.getElementById('achieve-bar').style.width = savedProgress + "%";
    }

    /* ==========================
       âœ…âœ… ì‹œí—˜ DB ë¯¸ë¦¬ë³´ê¸° "ì™„ì „íŒ" (ì—°ê²°ì¤‘ ê³ ì¹˜ê¸° + ì‹œí—˜DBì™€ í†µì¼)
       ========================== */

    function isFiniteNumber(v){ return Number.isFinite(Number(v)); }
    function safeParse(raw){ try { return JSON.parse(raw); } catch(e){ return null; } }

    // exam.htmlìª½ ì² í•™: ë°°ì—´/ê°ì²´ ì–´ë–¤ í˜•íƒœë“  rowsë¥¼ ë½‘ì•„ë‚´ê¸°
    function extractRows(data){
      if(Array.isArray(data)) return data;
      if(data && typeof data === "object"){
        const keys = ["db","records","rows","data"];
        for(const k of keys) if(Array.isArray(data[k])) return data[k];
        for(const k of Object.keys(data)) if(Array.isArray(data[k])) return data[k];
      }
      return [];
    }

    // ì ìˆ˜ í•„ë“œê°€ ë­ë¡œ ë“¤ì–´ì™€ë„ ìµœëŒ€í•œ scoreë¡œ ì¡ê¸°
    function readScoreFromObject(obj){
      if(!obj || typeof obj !== "object") return null;

      const candidates = ["score","ì ìˆ˜","totalScore","total","currentScore","rawScore","points"];
      let best = null, bestScore = -Infinity;

      for(const key of Object.keys(obj)){
        const v = obj[key];
        if(!isFiniteNumber(v)) continue;
        const lk = key.toLowerCase();
        if(lk.includes("percentile") || lk.includes("ë°±ë¶„ìœ„")) continue;

        let s = 0;
        if(lk.includes("score") || lk.includes("ì ìˆ˜")) s += 10;
        if(lk.includes("total") || lk.includes("ì´ì ") || lk.includes("raw")) s += 6;
        if(candidates.some(c => c.toLowerCase() === lk)) s += 2;

        const n = Number(v);
        if(n >= 0 && n <= 100) s += 1;

        if(s > bestScore){
          bestScore = s;
          best = n;
        }
      }
      return (bestScore > -Infinity) ? best : null;
    }

    // mock ìµœì‹ ê°’: date/createdAt/ts ìˆìœ¼ë©´ ê·¸ê±¸ë¡œ, ì—†ìœ¼ë©´ ë§ˆì§€ë§‰ í–‰
    function readTime(row){
      if(!row || typeof row !== "object") return null;
      const dateKeys = ["date","createdAt","ts","timestamp","time","datetime"];
      for(const k of dateKeys){
        const v = row[k];
        if(v == null) continue;
        if(isFiniteNumber(v)) return Number(v);
        if(typeof v === "string"){
          const t = new Date(v).getTime();
          if(Number.isFinite(t)) return t;
        }
      }
      return null;
    }

    function pickLatestRow(rows){
      if(!rows.length) return null;
      let best = rows[rows.length - 1];
      let bestT = -Infinity;
      for(const r of rows){
        const t = readTime(r);
        if(t !== null && t >= bestT){
          bestT = t;
          best = r;
        }
      }
      return best;
    }

    // âœ… ì—¬ê¸°ì„œë¶€í„° í•µì‹¬: "ë¬´ì¡°ê±´ UIë¥¼ ê°±ì‹ "í•¨ (ì—°ê²°ì¤‘ ê³ ì • ë°©ì§€)
    function setExamPreview(kind, current, goal){
      const infoEl = document.getElementById(`main-${kind}-score-info`);
      const barEl  = document.getElementById(`main-${kind}-bar`);
      if(!infoEl || !barEl) return;

      const safeGoal = isFiniteNumber(goal) ? Number(goal) : 100;

      if(!isFiniteNumber(current)){
        infoEl.innerText = `í˜„ì¬:- / ëª©í‘œ:${safeGoal}`;
        barEl.style.width = `0%`;
        return;
      }

      infoEl.innerText = `í˜„ì¬:${current} / ëª©í‘œ:${safeGoal}`;
      barEl.style.width = Math.min((Number(current) / safeGoal) * 100, 100) + '%';
    }

    function syncMainExamData(){
      const mockGoal = Number(localStorage.getItem(`exam_goal_v1:${currentMajor}:mock`)) || 100;
      const pastGoal = Number(localStorage.getItem(`exam_goal_v1:${currentMajor}:past`)) || 100;

      // âœ… ê¸°ë³¸ê°’ìœ¼ë¡œ ë¨¼ì € UIë¥¼ "ì—°ê²°ì¤‘"ì—ì„œ ë²—ê²¨ë†“ìŒ
      setExamPreview("mock", null, mockGoal);
      setExamPreview("past", null, pastGoal);

      // --- mock (ìµœì‹  1ê°œ) ---
      {
        const raw = localStorage.getItem("mockDB_records_v1");
        const parsed = safeParse(raw);
        const rows = extractRows(parsed);

        const subjectRows = rows.filter(r =>
          r && r.subject && String(r.subject).trim() === String(currentMajor).trim()
        );

        const latest = pickLatestRow(subjectRows);
        const current = latest ? readScoreFromObject(latest) : null;

        setExamPreview("mock", current, mockGoal);
      }

      // --- past (í‰ê· ) ---
      // --- past (ìµœì‹  ì—°ë„ í‰ê· : ì‹œí—˜DBì™€ ë™ì¼í•˜ê²Œ) ---
{
  const raw = localStorage.getItem("gi_db_v2");
  const parsed = safeParse(raw);
  const rows = extractRows(parsed);

  const subjectRows = rows.filter(r =>
    r && r.subject && String(r.subject).trim() === String(currentMajor).trim()
  );

  // âœ… ì—°ë„ ë½‘ê¸°: row.year ìš°ì„ , ì—†ìœ¼ë©´ dateë¥˜ë¡œ ì‹œë„
  function getYearFromRow(row){
    if(!row || typeof row !== "object") return null;
    if(isFiniteNumber(row.year)) return Number(row.year);

    const dateKeys = ["year","date","createdAt","ts","timestamp","time","datetime"];
    for(const k of dateKeys){
      const v = row[k];
      if(v == null) continue;

      if(isFiniteNumber(v)) {
        // year ìì²´ë©´ ê·¸ëŒ€ë¡œ, timestampë©´ Dateë¡œ
        const n = Number(v);
        if(n >= 1900 && n <= 2100) return n;
        const y = new Date(n).getFullYear();
        if(Number.isFinite(y)) return y;
      }

      if(typeof v === "string"){
        const m = v.match(/^(\d{4})/);
        if(m) return Number(m[1]);
        const y = new Date(v).getFullYear();
        if(Number.isFinite(y)) return y;
      }
    }
    return null;
  }

  // âœ… ì—°ë„ë³„ë¡œ ì ìˆ˜ ë‹´ê¸°
  const buckets = new Map(); // year -> [scores]
  for(const r of subjectRows){
    const sc = readScoreFromObject(r);
    if(!isFiniteNumber(sc)) continue;

    const y = getYearFromRow(r) ?? "ALL";
    if(!buckets.has(y)) buckets.set(y, []);
    buckets.get(y).push(Number(sc));
  }

  let current = null;

  if(buckets.size){
    // ìˆ«ì year ì¤‘ ê°€ì¥ ìµœì‹  ì„ íƒ
    const years = [...buckets.keys()].filter(k => isFiniteNumber(k)).map(Number);
    const chosen = years.length ? Math.max(...years) : "ALL";
    const arr = buckets.get(chosen) || buckets.get("ALL") || [];

    if(arr.length){
      current = Math.round((arr.reduce((a,b)=>a+b,0)/arr.length) * 10) / 10;
    }
  }

  setExamPreview("past", current, pastGoal);
}
    }

    /* ì²´í¬DB ìš”ì•½ */
    function syncCheckData() {
      const todayStr = new Date().toISOString().split('T')[0];
      const prefix = `checkDB_v2:day:${todayStr}:${currentMajor}`;
      let errs = [], pts = [];

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith(prefix)) {
          const rows = JSON.parse(localStorage.getItem(key) || "[]");
          rows.forEach(r => { if(r.error) errs.push(r.error); if(r.part) pts.push(r.part); });
        }
      }

      const updateUI = (displayId, list, canvasId) => {
        if (list.length > 0) {
          const counts = {};
          list.forEach(item => counts[item] = (counts[item] || 0) + 1);
          document.getElementById(displayId).innerText =
            Object.entries(counts).sort((a,b) => b[1]-a[1])[0][0];

          const ctx = document.getElementById(canvasId).getContext('2d');
          if (window[canvasId + 'Chart']) window[canvasId + 'Chart'].destroy();
          window[canvasId + 'Chart'] = new Chart(ctx, {
            type: 'doughnut',
            data: { datasets: [{ data: Object.values(counts), backgroundColor: ["#ff8fa3", "#ffd6a5", "#cdb4db", "#a2d2ff", "#fdfd96"], borderWidth: 0 }] },
            options: { cutout: '70%', plugins: { legend: { display: false } } }
          });
        } else {
          document.getElementById(displayId).innerText = "ê¸°ë¡ ì—†ìŒ";
        }
      };

      updateUI('main-top-error', errs, 'main-error-chart');
      updateUI('main-top-part', pts, 'main-part-chart');
    }

    /* ==========================
       âœ… ëª©í‘œDB(ê¸°ì¶œ ê¸°ë°˜ ìœ ë¦¬í•œ í•™êµ) (ì›ë³¸ ìœ ì§€)
       ========================== */

    function loadGiDB(){
      try{
        const raw = localStorage.getItem("gi_db_v2");
        if(!raw) return { db: [] };
        const parsed = JSON.parse(raw);
        const db = Array.isArray(parsed) ? parsed : (Array.isArray(parsed.db) ? parsed.db : []);
        return { db };
      }catch(e){
        return { db: [] };
      }
    }

    function normSchool(name){
      return String(name || "")
        .trim()
        .replace(/\s+/g, "")
        .replace(/ëŒ€í•™êµ$/,"ëŒ€")
        .replace("ëŒ€í•™êµ","ëŒ€");
    }

    function mean(arr){
      if(!arr || arr.length === 0) return null;
      return arr.reduce((a,b)=>a+b,0) / arr.length;
    }

    function stddev(arr){
      if(!arr || arr.length < 2) return 0;
      const m = mean(arr);
      const v = arr.reduce((acc,x)=>acc + (x-m)*(x-m), 0) / (arr.length - 1);
      return Math.sqrt(v);
    }

    function getRecentYears(db, subject, n=3){
      const years = Array.from(new Set(
        db
          .filter(r => r.subject === subject && Number.isFinite(Number(r.year)))
          .map(r => Number(r.year))
      )).sort((a,b)=>b-a);

      return years.slice(0, n);
    }

    function buildStats3y({ subject=currentMajor, recentN=3 }={}){
      const { db } = loadGiDB();
      const years = getRecentYears(db, subject, recentN);

      if(!years.length) return { years:[], overallAvg:null, bySchool:new Map() };

      const rows = db.filter(r =>
        r.subject === subject &&
        years.includes(Number(r.year)) &&
        r.school &&
        Number.isFinite(Number(r.score))
      );

      const allScores = rows.map(r => Number(r.score));
      const overallAvg = mean(allScores);

      const bySchoolScores = new Map();
      for(const r of rows){
        const s = normSchool(r.school);
        const score = Number(r.score);
        if(!bySchoolScores.has(s)) bySchoolScores.set(s, []);
        bySchoolScores.get(s).push(score);
      }

      const bySchool = new Map();
      for(const [school, scores] of bySchoolScores.entries()){
        bySchool.set(school, {
          scores,
          avg: mean(scores),
          std: stddev(scores),
          n: scores.length
        });
      }

      return { years, overallAvg, bySchool };
    }

    function pickBestSchoolByZ({ subject=currentMajor, recentN=3 }={}){
      const { years, overallAvg, bySchool } = buildStats3y({ subject, recentN });
      if(!Number.isFinite(overallAvg)) return null;

      let best = null;

      for(const [school, st] of bySchool.entries()){
        const schoolAvg = st.avg;
        if(!Number.isFinite(schoolAvg)) continue;

        const std = Number.isFinite(st.std) ? st.std : 0;
        const diff = overallAvg - schoolAvg;

        const denom = (std > 0) ? std : 0.000001;
        const z = diff / denom;

        const row = { school, overallAvg, schoolAvg, std, diff, z, years, n: st.n };

        if(
          !best ||
          row.z > best.z ||
          (row.z === best.z && row.diff > best.diff) ||
          (row.z === best.z && row.diff === best.diff && row.std < best.std)
        ){
          best = row;
        }
      }

      return best;
    }

    function renderMainBest() {
  // âœ… gi_db_v2ì—ì„œ "í˜„ì¬ ê³¼ëª©(currentMajor)" + "ìµœê·¼ 3ê°œë…„" ê¸°ì¤€ìœ¼ë¡œ
  // âœ… í•™êµë³„ í‰ê· ì´ ê°€ì¥ ë†’ì€ ê³³ì„ "ìœ ë¦¬í•œ ëŒ€í•™"ìœ¼ë¡œ ì„ ì •

  const $name = document.getElementById("mainBestSchoolName");
  const $avg  = document.getElementById("mainSchoolAvg");
  const $diff = document.getElementById("mainAvgDiff");
  const $std  = document.getElementById("mainSchoolStd");
  const setText = (el, txt) => { if(el) el.textContent = txt; };

  // 1) ì›ë³¸ ë¡œë“œ (ë°°ì—´ / {db:[...]} ë‘˜ ë‹¤ ëŒ€ì‘)
  let raw = localStorage.getItem("gi_db_v2");
  if(!raw){
    setText($name, "ë°ì´í„° ì—†ìŒ"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  let parsed;
  try { parsed = JSON.parse(raw); } catch(e){
    setText($name, "ë°ì´í„° ì˜¤ë¥˜"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  const db = Array.isArray(parsed) ? parsed : (Array.isArray(parsed.db) ? parsed.db : []);
  if(!db.length){
    setText($name, "ë°ì´í„° ì—†ìŒ"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  // 2) ê³¼ëª© í•„í„° + ì ìˆ˜/ì—°ë„ ìœ íš¨ ë°ì´í„°ë§Œ
  const subjectRows = db.filter(r =>
    r && String(r.subject || "").trim() === String(currentMajor).trim() &&
    r.school && String(r.school).trim() !== "" &&
    Number.isFinite(Number(r.score)) &&
    Number.isFinite(Number(r.year))
  );

  if(!subjectRows.length){
    setText($name, "ë°ì´í„° ì—†ìŒ"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  // 3) ìµœê·¼ 3ê°œë…„ ë½‘ê¸°
  const years = Array.from(new Set(subjectRows.map(r => Number(r.year)))).sort((a,b)=>b-a).slice(0,3);
  const rows3y = subjectRows.filter(r => years.includes(Number(r.year)));

  if(!rows3y.length){
    setText($name, "ë°ì´í„° ì—†ìŒ"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  // 4) ì „ì²´ í‰ê· (ë¹„êµìš©)
  const allScores = rows3y.map(r => Number(r.score));
  const overallAvg = allScores.reduce((a,b)=>a+b,0) / allScores.length;

  // 5) í•™êµë³„ë¡œ ë¬¶ê¸°
  const bySchool = new Map();
  for(const r of rows3y){
    const school = String(r.school).trim();
    const score = Number(r.score);
    if(!bySchool.has(school)) bySchool.set(school, []);
    bySchool.get(school).push(score);
  }

  // í‘œì¤€í¸ì°¨(í‘œë³¸) ê³„ì‚°
  const mean = arr => arr.reduce((a,b)=>a+b,0) / arr.length;
  const stddevSample = arr => {
    if(arr.length < 2) return 0;
    const m = mean(arr);
    const v = arr.reduce((acc,x)=>acc + (x-m)*(x-m), 0) / (arr.length - 1);
    return Math.sqrt(v);
  };

  // 6) âœ… "í‰ê·  ì ìˆ˜ ë†’ì€ í•™êµ" ê³ ë¥´ê¸°
  let best = null;

  for(const [school, scores] of bySchool.entries()){
    const avg = mean(scores);
    const std = stddevSample(scores);
    const n = scores.length;

    const row = { school, avg, std, n };

    if(
      !best ||
      row.avg > best.avg ||
      (row.avg === best.avg && row.std < best.std) ||
      (row.avg === best.avg && row.std === best.std && row.n > best.n)
    ){
      best = row;
    }
  }

  if(!best){
    setText($name, "ë°ì´í„° ì—†ìŒ"); setText($avg, "-"); setText($std, "-"); setText($diff, "-");
    return;
  }

  // 7) UI ë°˜ì˜
  const diff = best.avg - overallAvg;
  const sign = diff >= 0 ? "+" : "";

  setText($name, best.school);
  setText($avg,  best.avg.toFixed(1) + "ì ");
  setText($std,  "Â±" + best.std.toFixed(1));
  setText($diff, `ì°¨ì´ ${sign}${diff.toFixed(1)}`);
}

document.querySelectorAll('.theme-selector .theme-dot').forEach(btn => {
  btn.addEventListener('click', () => {
    const url = btn.dataset.go;
    if (url) window.location.href = url;
  });
});

    /* ì´ˆê¸° ë¡œë“œ */
    window.addEventListener('DOMContentLoaded', () => {
      buildCalendar();
      initTrackerUI();
      syncAchievePreview();
      syncMainExamData(); // âœ… ë°˜ë“œì‹œ í˜¸ì¶œ
      syncCheckData();
      renderMainBest();
    });
  </script>
  <script>
        // 1. ëª‡ ë²ˆ ëˆŒë €ëŠ”ì§€ ê¸°ì–µí•  'ë¹„ë°€ ì¥ë¶€'
        let clickCount = 0;
        
        // 2. 5ë²ˆ í´ë¦­í•˜ë©´ ê¸ˆê³  ì—´ê¸°
        function handleVersionClick() {
            clickCount++;
            if (clickCount === 5) {
                document.getElementById('secret-modal').style.display = 'block';
                clickCount = 0;
            }
        }

        // 3. ë‹«ê¸° ë²„íŠ¼ìš©
        function closeSecretModal() {
            document.getElementById('secret-modal').style.display = 'none';
        }

        // 4. (ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ëŠ”) ì½”ë“œ í™•ì¸ í•¨ìˆ˜
        function checkMySecretCode() {
    const userInput = document.getElementById('secret-input').value;

    // ì‚¬ì¥ë‹˜! ì—¬ê¸°ì— 'ê¸°ì¡´ ì›¹ë²„ì „ ë¹„ë°€ë²ˆí˜¸'ë¥¼ ê·¸ëŒ€ë¡œ ì ì–´ì£¼ì„¸ìš”.
    const masterCode = "g8s2k7wq"; 

    if (userInput === masterCode) {
        // [ì„±ê³µ] "ì›¹ì—ì„œ ì˜¤ì‹  VIPë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!" ë¼ëŠ” ë„ì¥ì„ ì°ì–´ì¤ë‹ˆë‹¤.
        localStorage.setItem("isFullVersion", "true"); 
        alert("ğŸŒ¸ ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤! ì›¹ë²„ì „ì˜ í˜œíƒì„ ì•±ì—ì„œë„ ê·¸ëŒ€ë¡œ ëˆ„ë¦¬ì„¸ìš”.");
        location.reload(); 
    } else {
        alert("ì½”ë“œê°€ í‹€ë ¸ì–´ìš”. ì›¹ë²„ì „ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”! ğŸŒ¸");
    }
}
    </script>
  <footer style="text-align: center; font-size: 10px; color: #aaa; margin-top: 20px;">
    <p>Copyright 2026. ì„œì—°. All rights reserved.</p>
    <p id="version-trigger" onclick="handleVersionClick()" style="cursor: default;">image from Pixabey(by Aisvarya Kalyansundaram)</p>
  </footer>
  <div id="secret-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #ffc0cb; padding: 20px; z-index: 1000; border-radius: 15px; text-align: center;">
    <p style="color: #ff69b4; font-weight: bold;">ğŸŒ¸ VIP ì¸ì¦ ì½”ë“œ ì…ë ¥</p>
    <input type="text" id="secret-input" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="border: 1px solid #ffc0cb; border-radius: 5px; padding: 5px;">
    <button onclick="checkMySecretCode()" style="background: #ffc0cb; border: none; border-radius: 5px; padding: 5px 10px; color: white;">í™•ì¸</button>
    <button onclick="closeSecretModal()" style="background: #eee; border: none; border-radius: 5px; padding: 5px 10px; margin-top: 10px;">ë‹«ê¸°</button>
</div>
<script src="trial.js"></script>
<script>
    // ğŸ’¡ ì—¬ê¸°ì„œ 'let'ì„ ë˜ ì“°ì§€ ë§ˆì„¸ìš”! 
    // ì´ë¯¸ trial.jsì—ì„œ ë§Œë“  'isFullVersion'ì„ ê·¸ëƒ¥ ê°€ì ¸ë‹¤ ì“°ë©´ ë©ë‹ˆë‹¤.
    if (isFullVersion) {
        console.log("ì‚¬ì¥ë‹˜, VIP ì¸ì¦ í™•ì¸ëìŠµë‹ˆë‹¤! ğŸŒ¸");
    }
</script>
<script>
  // 1. ëª¨ë“  í…Œë§ˆ ë²„íŠ¼ì„ ë‹¤ ì°¾ì•„ì™€!
  document.querySelectorAll('.theme-dot').forEach(button => {
    button.addEventListener('click', () => {
      // 2. ë²„íŠ¼ì— ì íŒ data-theme ê°’(pink, blue ë“±)ì„ ê°€ì ¸ì™€ì„œ
      const selectedColor = button.getAttribute('data-theme');
      
      // 3. trial.jsì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì„œ ì €ì¥í•˜ê³  ì´ë™!
      selectTheme(selectedColor); 
      
      // 4. (ì„ íƒì‚¬í•­) ì˜ ì‘ë™í•˜ëŠ”ì§€ ì½˜ì†”ë¡œ í™•ì¸
      console.log(selectedColor + " í…Œë§ˆë¡œ ë³€ê²½ ì‹œë„!");
    });
  });
</script>
</body>
</html>